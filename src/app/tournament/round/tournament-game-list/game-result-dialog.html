<md-dialog-content>
  <ng-container *ngIf="!gameModel">
    <div class="heading">Load Game...
      <mdl-spinner single-color active></mdl-spinner>
    </div>
  </ng-container>
  <span *ngIf="!(isConnected$ | async) && !isAdmin  && !isCoOrganizer">
      You cannot inserted your gameResult while offline!
      <md-icon class="offline_icon"
               mdTooltip="No Connection">
        signal_wifi_off
      </md-icon>
    </span>
  <span *ngIf="!(isConnected$ | async) && !isAdmin && isCoOrganizer">
      Online the Tournament organizer can insert results while offline.
      This should prevent race conditions while offline.
      <md-icon class="offline_icon"
               mdTooltip="No Connection">
        signal_wifi_off
      </md-icon>
    </span>
  <form *ngIf="(isConnected$ | async) || isAdmin" #gameForm="ngForm">
    <div class="game-result-container">
      <md-card class="game-result-card"
               [ngClass]="{'card-won': gameModel.playerOneScore == 1,
                           'card-not-won': gameModel.playerOneScore == 0} ">
        <h4 class="game-result-playerName">{{gameModel.playerOnePlayerName | truncate:35}}</h4>
        <div *ngIf="gameModel.playerOneScore" class="score-heading-label">WON</div>
        <div *ngIf="gameModel.playerTwoScore" class="score-heading-label">LOST</div>
        <div *ngIf="!gameModel.playerTwoScore && !gameModel.playerOneScore" class="score-heading-label">DRAW</div>

        <div class="full-width game-result-card-line">
          <mdl-switch (change)="playerOneWinChange()"
                      [(ngModel)]="gameModel.playerOneScore"
                      name="playerOneWin"
                      class="player-score-switch"
                      mdl-ripple>Score
          </mdl-switch>
        </div>

        <div class="full-width game-result-card-line">
          <md-icon
            class="remove-button"
            (click)="decreasePlayerOneCP()">
            remove_circle_outline
          </md-icon>
          <md-input-container class="game-result-input">
            <input
              mdInput
              type="number"
              min="0" max="{{gameConfig.points[1].max}}"
              placeholder="CP"
              #playerOneControlPoints
              (blur)="correctPlayerOneCPInput()"
              [(ngModel)]="gameModel.playerOneControlPoints"
              name="playerOneControlPoints">
          </md-input-container>
          <md-icon
            class="add-button"
            (click)="increasePlayerOneCP()">
            add_circle_outline
          </md-icon>
        </div>
        <div class="full-width game-result-card-line">
          <md-icon
            class="remove-button"
            (click)="decreasePlayerOneVP()">
            remove_circle_outline
          </md-icon>
          <md-input-container class="game-result-input">
            <input
              mdInput
              type="number"
              min="0" max="{{gameConfig.points[2].max}}"
              placeholder="VP"
              #playerOneVictoryPoints
              (blur)="correctPlayerOneVPInput()"
              [(ngModel)]="gameModel.playerOneVictoryPoints"
              name="playerOneVictoryPoints">
          </md-input-container>
          <md-icon
            class="add-button"
            (click)="increasePlayerOneVP()">
            add_circle_outline
          </md-icon>
        </div>
        <md-select *ngIf="playerOneArmyLists?.length > 0; else noArmyList"
                   class="full-width"
                   placeholder="PlayerOne ArmyList"
                   #playerOneArmyList
                   name="playerOneArmyList"
                   [(ngModel)]="gameModel.playerOneArmyList">
          <md-option *ngFor="let armyList of playerOneArmyLists" [value]="armyList.name">{{ armyList.name }}</md-option>
        </md-select>
      </md-card>
      <div class="game-result-card-divider">
        VS
      </div>
      <md-card class="game-result-card"
               [ngClass]="{'card-won': gameModel.playerTwoScore == 1,
                           'card-not-won': gameModel.playerTwoScore == 0} ">
        <h4 class="game-result-playerName">{{gameModel.playerTwoPlayerName | truncate:35}}</h4>
        <div *ngIf="gameModel.playerOneScore" class="score-heading-label">LOST</div>
        <div *ngIf="gameModel.playerTwoScore" class="score-heading-label">WON</div>
        <div *ngIf="!gameModel.playerTwoScore && !gameModel.playerOneScore" class="score-heading-label">DRAW</div>

        <div class="full-width game-result-card-line">
          <mdl-switch (change)="playerTwoWinChange()"
                      [(ngModel)]="gameModel.playerTwoScore"
                      name="playerTwoWin"
                      class="player-score-switch"
                      mdl-ripple>Score
          </mdl-switch>
        </div>

        <div class="full-width game-result-card-line">
          <md-icon
            class="remove-button"
            (click)="decreasePlayerTwoCP()">
            remove_circle_outline
          </md-icon>
          <md-input-container class="game-result-input">
            <input
              mdInput
              type="number"
              min="0" max="{{gameConfig.points[1].max}}"
              maxlength="2"
              placeholder="CP"
              #playerTwoControlPoints
              (blur)="correctPlayerTwoCPInput()"
              [(ngModel)]="gameModel.playerTwoControlPoints"
              name="playerTwoControlPoints">
          </md-input-container>
          <md-icon
            class="add-button"
            (click)="increasePlayerTwoCP()">
            add_circle_outline
          </md-icon>
        </div>
        <div class="full-width game-result-card-line">
          <md-icon
            class="remove-button"
            (click)="decreasePlayerTwoVP()">
            remove_circle_outline
          </md-icon>
          <md-input-container class="game-result-input">
            <input
              mdInput
              type="number"
              min="0" max="{{gameConfig.points[2].max}}"
              maxlength="3"
              placeholder="VP"
              #playerTwoVictoryPoints
              (blur)="correctPlayerTwoVPInput()"
              [(ngModel)]="gameModel.playerTwoVictoryPoints"
              name="playerTwoVictoryPoints">
          </md-input-container>
          <md-icon
            class="add-button"
            (click)="increasePlayerTwoVP()">
            add_circle_outline
          </md-icon>
        </div>
        <md-select *ngIf="playerTwoArmyLists?.length > 0; else noArmyList"
                   class="full-width"
                   placeholder="PlayerTwo ArmyList"
                   #playerTwoArmyList
                   name="playerTwoArmyList"
                   [(ngModel)]="gameModel.playerTwoArmyList">
          <md-option *ngFor="let armyList of playerTwoArmyLists" [value]="armyList.name">{{ armyList.name }}</md-option>
        </md-select>
        <ng-template #noArmyList>No ArmyList for Player found</ng-template>
      </md-card>
    </div>
  </form>
</md-dialog-content>
<md-dialog-actions>
  <div class="full-width">
    <button class="big-button" type="button" color="primary" md-raised-button (click)="dialogRef.close()">Close Dialog
    </button>
    <button *ngIf="sureButton"
            (click)="pushGameResult()"
            class="right-align-button big-button color-positive-background"
            type="button"
            md-raised-button>
      <md-icon>check</md-icon>
      Really no winner?
    </button>
    <button *ngIf="!sureButton  && ((isConnected$ | async) || isAdmin || isCoOrganizer)"
            (click)="enterGameResultSubmitted()"
            class="right-align-button big-button"
            type="button"
            color="accent"
            md-raised-button>
      <md-icon>check</md-icon>
      Enter Game Result
    </button>
  </div>
</md-dialog-actions>
